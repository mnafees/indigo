<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Notepad</title>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:300,400,600,700">
    <link rel="stylesheet" type="text/css" href="main.css">
</head>
<body>
    <div class="top-bar">
        <input type="text" name="gh-username" placeholder="GitHub username">
        <input type="password" name="gh-password" placeholder="GitHub password">
        <input type="button" class="white" value="Save As Gist" onclick="saveAsGist();">
    </div>
    <textarea placeholder="Type here"></textarea>
    <div id="keyboard"></div>

    <script type="text/javascript" src="main.js"></script>
    <script src="octokit-rest.min.js"></script>
    <script type="text/javascript">
        enableKeyboard(document.querySelector("#keyboard"));
        function saveAsGist() {
            var textArea = document.querySelector("textarea");
            if (textArea.value !== "") {
                var gh_username = document.querySelector("input[name=gh-username]");
                var gh_password = document.querySelector("input[name=gh-password]");
                if (gh_username.value === "") {
                    alert("Empty GitHub username!");
                } else if (gh_password.value === "") {
                    alert("Empty GitHub password!");
                }

                const octokit = new Octokit();

                octokit.authenticate({
                    type: 'basic',
                    username: gh_username.value,
                    password: gh_password.value
                });
                const filename = "hifi-notepad-" + Date.now() + ".txt";
                var files_content = new Object();
                files_content[filename] = new Object();
                files_content[filename]['content'] = textArea.value;
                octokit.gists.create({
                    public: false,
                    files: files_content
                }).then(function(res) {
                    if (res.data) {
                        alert("Gist created at: " + res.data.url);
                    }
                }).catch(function(err) {
                    alert("Error creating Gist:\n" + err.message);
                });
            } else {
                alert("Empty text body!");
            }
        }
    </script>
</body>
</html>